<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Poll Results</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
</head>
<body>

  <div class="container" style="max-width: 800px; margin-top: 40px;">

    <h1 id="question" class="text-center mb-4">Loading question...</h1>

    <div id="results-container">
      </div>
    
    <hr class="my-4">
    <p class="text-center text-muted">
      Go to <a href="/" target="_blank">the voting page</a> to cast your vote!
    </p>

  </div>


  <script>
    const questionEl = document.getElementById('question');
    const resultsContainer = document.getElementById('results-container');
    const ws = new WebSocket(`ws://${window.location.host}`);

    ws.onopen = () => console.log('Connected to WebSocket server');
    ws.onclose = () => {
      console.log('Disconnected from WebSocket server');
      questionEl.textContent = 'Disconnected. Please refresh.';
    };

    ws.onmessage = (event) => {
      const poll = JSON.parse(event.data);
      updatePollUI(poll);
    };

    function updatePollUI(poll) {
      questionEl.textContent = poll.question;
      resultsContainer.innerHTML = ''; // Clear old results

      const totalVotes = Object.values(poll.options).reduce((a, b) => a + b, 0);

      for (const [option, votes] of Object.entries(poll.options)) {
        const percentage = (totalVotes === 0) ? 0 : (votes / totalVotes) * 100;
        
        // 3. Create Bootstrap-styled result elements
        const resultEl = document.createElement('div');
        resultEl.className = 'mb-3'; // Margin-bottom utility

        // We use Bootstrap's progress bar components
        resultEl.innerHTML = `
          <h4 class="d-flex justify-content-between">
            <span>${option}</span>
            <span class="text-muted">${votes} votes</span>
          </h4>
          <div class="progress" role="progressbar" aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100" style="height: 30px;">
            <div class="progress-bar" style="width: ${percentage.toFixed(1)}%;">
              ${percentage.toFixed(1)}%
            </div>
          </div>
        `;
        
        resultsContainer.appendChild(resultEl);
      }
    }
  </script>

</body>
</html>